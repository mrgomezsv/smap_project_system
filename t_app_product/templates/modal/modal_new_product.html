<!-- modal_new_product.html -->
<div id="newProductModal" class="componente-con-borde" style="display: none;">
  <div class="row">
    <div class="mb-3">
      <h3>Crear Nuevo Producto</h3>
    </div>
    <!-- Formulario con CSRF Token, método POST y carga de archivos -->
    <form method="POST" enctype="multipart/form-data" action="{% url 'create_product' %}">
      {% csrf_token %}
      <div class="row">
        <!-- Columna Izquierda: Campos de texto -->
        <div class="col-md-6">
          <div class="mb-3">
            <label for="title" class="form-label">Nombre del Producto</label>
            <input type="text" class="form-control" id="title" name="title"
                   placeholder="Ingresa el nombre del producto" required>
          </div>
          <div class="mb-3">
            <label for="description" class="form-label">Descripción</label>
            <textarea class="form-control" id="description" name="description"
                      placeholder="Ingresa la descripción del producto" rows="3" required></textarea>
          </div>
          <div class="mb-3">
            <label for="circuits" class="form-label">Circuitos Necesarios</label>
            <input type="text" class="form-control" id="circuits" name="circuits"
                   placeholder="2">
          </div>
          <div class="mb-3">
            <label for="dimensions" class="form-label">Dimensiones del Juego</label>
            <input type="text" class="form-control" id="dimensions" name="dimensions"
                   placeholder="Ingresa 13x10" required>
          </div>
          <div class="mb-3">
            <label for="space" class="form-label">Espacio Necesario</label>
            <input type="text" class="form-control" id="space" name="space"
                   placeholder="Ingresa 13x10">
          </div>
          <div class="mb-3">
            <label for="category" class="form-label">Categoría</label>
            <select class="form-select" id="category" name="category" required>
              <option value="option1">Bounce House</option>
              <option value="option2">Electric Games</option>
              <option value="option3">Furniture</option>
              <option value="option4">Concession Machines</option>
              <option value="option5">Competitive Games</option>
              <option value="option6">Equipment Rental</option>
              <option value="option7">Water Fun for Rent</option>
            </select>
          </div>
          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" value="publicated" id="publicated" name="publicated">
            <label class="form-check-label" for="publicated">
              Producto Publicado
            </label>
          </div>
        </div>

        <!-- Columna Derecha: Carga de imágenes y YouTube URL -->
        <div class="col-md-6">
          <div class="mb-3">
            <label for="img" class="form-label">Imagen de Portada</label>
            <input class="form-control" type="file" id="img" name="img" required>
          </div>
          <div class="mb-3">
            <label for="img1" class="form-label">Imagen 1</label>
            <input class="form-control" type="file" id="img1" name="img1">
          </div>
          <div class="mb-3">
            <label for="img2" class="form-label">Imagen 2</label>
            <input class="form-control" type="file" id="img2" name="img2">
          </div>
          <div class="mb-3">
            <label for="img3" class="form-label">Imagen 3</label>
            <input class="form-control" type="file" id="img3" name="img3">
          </div>
          <div class="mb-3">
            <label for="img4" class="form-label">Imagen 4</label>
            <input class="form-control" type="file" id="img4" name="img4">
          </div>
          <div class="mb-3">
            <label for="img5" class="form-label">Imagen 5</label>
            <input class="form-control" type="file" id="img5" name="img5">
          </div>
          <div class="mb-3">
            <label for="youtube_url" class="form-label">YouTube URL</label>
            <input type="url" class="form-control" id="youtube_url" name="youtube_url"
                   placeholder="Ejemplo: https://www.youtube.com/watch?v=yourvideo">
          </div>
        </div>
      </div>
      <!-- Botón de envío, centrado en la última fila -->
      <div class="mt-4 text-center">
        <button type="submit" class="btn btn-primary">Crear Producto</button>
        <button type="button" class="btn btn-danger ml-2" id="cancelarBtn">Cancelar</button>
      </div>
    </form>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $('#crearBtn').click(function () {
            var title = $('#title').val();
            var description = $('#description').val();
            var price = $('#price').val();
            var category = $('#category').val();
            var dimensions = $('#dimensions').val();
            var publicated = $('#publicated').prop('checked');
            var youtubeUrl = $('#youtube_url').val(); // Obtener el valor de YouTube URL
            var img = $('#img').prop('files')[0];
            var img1 = $('#img1').prop('files')[0];
            var img2 = $('#img2').prop('files')[0];
            var img3 = $('#img3').prop('files')[0];
            var img4 = $('#img4').prop('files')[0];
            var img5 = $('#img5').prop('files')[0];

            var formData = new FormData();
            formData.append('title', title);
            formData.append('description', description);
            formData.append('price', price);
            formData.append('category', category);
            formData.append('dimensions', dimensions);
            formData.append('publicated', publicated);
            formData.append('youtube_url', youtubeUrl); // Agregar YouTube URL al formData
            formData.append('img', img);
            formData.append('img1', img1);
            formData.append('img2', img2);
            formData.append('img3', img3);
            formData.append('img4', img4);
            formData.append('img5', img5);

            var csrftoken = getCookie('csrftoken');

            $.ajaxSetup({
                beforeSend: function (xhr, settings) {
                    if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                        xhr.setRequestHeader('X-CSRFToken', csrftoken);
                    }
                }
            });

            $.ajax({
                url: '/product/create/',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    window.location.href = '/product/';
                },
                error: function (xhr, status, error) {
                    console.error(error);
                    alert('Error al crear el producto. Por favor, intenta nuevamente.');
                }
            });
        });
    });

    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    function csrfSafeMethod(method) {
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }

</script>
